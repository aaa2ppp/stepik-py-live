<div>
    <div id="hiddenCounter" class="hidden">{{ generation.serial }}</div>
    <div class="hidden">{{ generation.__class__.__name__ }}</div>

    {% if generation.is_over -%}
        <h1 id="gameOver">GAME OVER</h1>
    {% else -%}
        <br>
    {% endif -%}

    {% if wss %}
        {% set size = (wss[0] * 2 // (generation.width * 3), wss[1] * 2 // (generation.height * 3)) | min %}
    {% else %}
        {% set size = (800 // generation.width, 480 // generation.height) | min %}
    {% endif %}

    {% if size < 8 %}
        {% set size = 8 %}
    {% elif size > 32 %}
        {% set size = 32 %}
    {% endif %}

    {# TODO: How to do this using styles if the width and height are dynamic? #}
    {% set cell_width = 'width:{}px;padding:0'.format(size) %}
    {% set cell_height = 'height:{}px;padding:0'.format(size) %}
    {% set cell_width_height = 'width:{}px;height:{}px;padding:0'.format(size, size) %}

    <table class="world" style="font-family: monospace;">
        {% set previous = generation.previous -%}
        <tr>
            {% if generation.is_live_cell(0, 0) -%}
                <td class="cell living-cell">
                    <div style="{{ cell_width_height }}">X</div>
                </td>
            {% elif previous and previous.is_live_cell(0, 0) -%}
                <td class="cell dead-cell">
                    <div style="{{ cell_width_height }}">D</div>
                </td>
            {% else -%}
                <td class="cell">
                    <div style="{{ cell_width_height }}">_</div>
                </td>
            {% endif -%}

            {% for col in range(1, generation.width) -%}
                {% if generation.is_live_cell(0, col) -%}
                    <td class="cell living-cell">
                        <div style="{{ cell_width }}">X</div>
                    </td>
                {% elif previous and previous.is_live_cell(0, col) -%}
                    <td class="cell dead-cell">
                        <div style="{{ cell_width }}">D</div>
                    </td>
                {% else -%}
                    <td class="cell">
                        <div style="{{ cell_width }}">_</div>
                    </td>
                {% endif -%}
            {% endfor -%}
        </tr>
        {% for row in range(1, generation.height) -%}
            <tr>
                {% if generation.is_live_cell(row, 0) -%}
                    <td class="cell living-cell">
                        <div style="{{ cell_height }}">X</div>
                    </td>
                {% elif previous and previous.is_live_cell(row, 0) -%}
                    <td class="cell dead-cell">
                        <div style="{{ cell_height }}">D</div>
                    </td>
                {% else -%}
                    <td class="cell">
                        <div style="{{ cell_height }}">_</div>
                    </td>
                {% endif -%}

                {% for col in range(1, generation.width) -%}
                    {% if generation.is_live_cell(row, col) -%}
                        <td class="cell living-cell">X</td>
                    {% elif previous and previous.is_live_cell(row, col) -%}
                        <td class="cell dead-cell">D</td>
                    {% else -%}
                        <td class="cell">_</td>
                    {% endif -%}
                {% endfor -%}
            </tr>
        {% endfor -%}
    </table>
</div>
